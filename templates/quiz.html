{% extends 'base.html' %}
{% load static %}

{% block title %}Your Python Quiz - QTRMRS{% endblock %}

{% block styles %}
<style>
    /* ======================================= */
    /* QUIZ PLAYER SPECIFIC STYLES (MD3) */
    /* ======================================= */

    .quiz-container {
        flex-grow: 1;
        padding: 24px;
        max-width: 800px;
        width: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 24px;
        /* FIX: Ensure container doesn't exceed screen height */
        height: calc(100vh - 64px); /* Full viewport height minus the top app bar */
        box-sizing: border-box;
    }

    .quiz-header {
        background-color: var(--md-sys-color-surface-container);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        flex-shrink: 0; /* Prevent header from shrinking */
    }

    .quiz-stats {
        display: flex;
        justify-content: space-between;
        margin-top: 8px;
        font-size: 14px;
        font-weight: 500;
        color: var(--md-sys-color-on-surface-variant);
    }

    #question-counter { color: var(--md-sys-color-primary); }
    .progress-bar-container { height: 8px; background-color: var(--md-sys-color-surface-container-high); border-radius: 4px; overflow: hidden; }
    .progress-bar { height: 100%; width: 0%; background-color: var(--md-sys-color-primary); transition: width 0.3s ease-in-out; border-radius: 4px; }

    .quiz-item-container {
        background-color: var(--md-sys-color-surface-container-high);
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        /* FIX: Allow this container to shrink and handle overflow */
        flex-shrink: 1;
        overflow-y: auto;
    }

    #question-text {
        font-size: 24px;
        font-weight: 700;
        margin-top: 0;
        margin-bottom: 24px;
        color: var(--md-sys-color-on-surface);
    }

    #options-container {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    
    .option-label {
        display: block;
        background-color: var(--md-sys-color-surface);
        color: var(--md-sys-color-on-surface);
        border: 1px solid var(--md-sys-color-outline);
        border-radius: 12px;
        padding: 16px;
        cursor: pointer;
        transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s;
        position: relative;
    }

    .option-label:hover {
        background-color: var(--md-sys-color-surface-container-low);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .option-input { position: absolute; opacity: 0; pointer-events: none; }
    .option-input:checked + .option-label { background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); border-color: var(--md-sys-color-primary); }
    
    .quiz-footer {
        display: flex;
        justify-content: flex-end;
        gap: 16px;
        padding: 16px 0;
        flex-shrink: 0; /* Prevent footer from shrinking */
    }
    
    #skip-btn {
        background-color: transparent;
        color: var(--md-sys-color-primary);
        border: 1px solid var(--md-sys-color-outline);
        border-radius: 20px;
        padding: 10px 24px;
        font-size: 14px;
        font-weight: 500;
        text-transform: uppercase;
        cursor: pointer;
    }
    
    #next-btn:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; }

</style>
{% endblock %}

{% block content %}
<main class="content-area" style="padding: 0; display: block;">
    <form id="quiz-question-form" action="{% url 'process_question' attempt_id=attempt.id question_number=question_number %}" method="POST">
        {% csrf_token %}
        <div id="quiz-player-container" class="quiz-container">
            <div class="quiz-header">
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar" style="width: {{ progress_percentage }}%;"></div>
                </div>
                <div class="quiz-stats">
                    <span id="question-counter">Question {{ question_number }} / {{ total_questions }}</span>
                </div>
            </div>
        
            <div class="quiz-item-container card">
                <h2 id="question-text">{{ question.question_text|safe }}</h2>
                
                <div id="options-container">
                    {% for option in question.options.all %}
                    <input type="radio" name="answer" id="opt{{ option.id }}" class="option-input" value="{{ option.id }}">
                    <label for="opt{{ option.id }}" class="option-label">
                        {{ option.option_text }}
                    </label>
                    {% endfor %}
                </div>
            </div>
            
            <div class="quiz-footer">
                <button type="submit" id="skip-btn" name="action" value="skip">Skip</button>
                <button type="submit" id="next-btn" class="md3-button-elevated" name="action" value="next" disabled>
                    {% if is_last_question %}
                        Finish Quiz
                    {% else %}
                        Next Question
                    {% endif %}
                </button>
            </div>
        </div>
    </form>
</main>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const nextBtn = document.getElementById('next-btn');
    const optionsContainer = document.getElementById('options-container');

    optionsContainer.addEventListener('change', (event) => {
        if (event.target.type === 'radio' && event.target.name === 'answer') {
            nextBtn.disabled = false;
        }
    });

    document.getElementById('quiz-question-form').addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && nextBtn.disabled) {
            event.preventDefault();
        }
    });
});
</script>
{% endblock %}